<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solar Yield Comparison for Zurich</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .chart-container {
            position: relative;
            margin: auto;
            height: 60vh;
            width: 90vw;
            max-width: 900px;
        }
        .small-chart-container {
            position: relative;
            margin: auto;
            height: 50vh;
            width: 90vw;
            max-width: 800px;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <div class="container mx-auto p-4 sm:p-6 lg:p-8">
        <!-- Main Yield Chart -->
        <div class="bg-white p-6 rounded-2xl shadow-lg mb-8">
            <h1 class="text-2xl sm:text-3xl font-bold text-gray-900 mb-2">Balcony Solar Yield Comparison</h1>
            <p class="text-gray-600 mb-4">Zurich | 75° Tilt</p>

            <div class="flex justify-center items-center space-x-4 mb-6 bg-gray-100 p-2 rounded-lg max-w-xs mx-auto">
                <label class="text-sm font-medium text-gray-700">View:</label>
                <div class="flex space-x-2">
                    <button id="viewMonthly" class="px-3 py-1 text-sm font-semibold text-white bg-blue-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">Monthly</button>
                    <button id="viewDaily" class="px-3 py-1 text-sm font-semibold text-gray-700 bg-white rounded-md shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">Daily</button>
                </div>
            </div>

            <div class="chart-container">
                <canvas id="solarYieldChart"></canvas>
            </div>
        </div>
        
        <!-- Hourly Production Curve -->
        <div class="bg-white p-6 rounded-2xl shadow-lg mb-8">
            <h2 class="text-2xl sm:text-3xl font-bold text-gray-900 mb-2">Hourly Production Curve</h2>
            <p class="text-gray-600 mb-4">Estimated panel output (in Watts) on a clear June day, comparing different orientations.</p>
            <div class="small-chart-container">
                <canvas id="productionCurveChart"></canvas>
            </div>
        </div>

        <!-- Charging Curve -->
        <div class="bg-white p-6 rounded-2xl shadow-lg mb-8">
            <h2 class="text-2xl sm:text-3xl font-bold text-gray-900 mb-2">Summer Day Charging Simulation</h2>
            <p class="text-gray-600 mb-4">Estimated charge curve for a 12.8V/50Ah battery (640Wh) starting at 20% on a clear June day, powered by a 220W system (2 panels @ 190° South).</p>
            <div class="small-chart-container">
                <canvas id="chargingCurveChart"></canvas>
            </div>
        </div>

        <!-- Analysis Section -->
        <div class="bg-white p-6 rounded-2xl shadow-lg">
            <h2 class="text-2xl font-bold text-gray-900 mb-4">Performance & Setup Analysis</h2>
            
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Scenario</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">PV Power</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Orientation</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Est. Annual Yield</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Best For</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                        <tr class="hover:bg-gray-50">
                            <td class="px-6 py-4 whitespace-nowrap"><div class="text-sm font-semibold text-gray-900">1. Base Setup (12V)</div></td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">110W</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">190° South</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-blue-600">~105 kWh</td>
                            <td class="px-6 py-4 text-sm text-gray-700">Basic battery charging.</td>
                        </tr>
                        <tr class="hover:bg-gray-50">
                            <td class="px-6 py-4 whitespace-nowrap"><div class="text-sm font-semibold text-gray-900">2. Expanded 12V</div></td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">220W</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">190° South</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-blue-600">~210 kWh</td>
                            <td class="px-6 py-4 text-sm text-gray-700">Faster charging, powering more devices.</td>
                        </tr>
                        <tr class="hover:bg-gray-50">
                            <td class="px-6 py-4 whitespace-nowrap"><div class="text-sm font-semibold text-gray-900">3. Expanded 24V</div></td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">220W</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">190° South</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-blue-600">~212 kWh</td>
                            <td class="px-6 py-4 text-sm text-gray-700">Higher efficiency, future-proofing.</td>
                        </tr>
                        <tr class="hover:bg-gray-50">
                            <td class="px-6 py-4 whitespace-nowrap"><div class="text-sm font-semibold text-gray-900">4. Split Orientation (12V/24V)</div></td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">220W</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">100° SE + 190° SW</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-blue-600">~195 kWh</td>
                            <td class="px-6 py-4 text-sm text-gray-700">Wider daily production window.</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Detailed Analysis -->
            <div class="mt-8 grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="bg-gray-50 p-4 rounded-lg md:col-span-2">
                    <h3 class="font-bold text-lg mb-2">12V vs 24V System Efficiency</h3>
                    <p class="text-sm text-gray-600">A 24V system is more efficient due to lower resistive losses (I²R losses) in the wiring. Power (Watts) = Voltage (Volts) x Current (Amps). For the same power, doubling the voltage halves the current. With a 220W setup, a 24V system has half the current of a 12V system (9.15A vs 18.3A), resulting in only <strong>1/4</strong> of the energy lost to heat in the wires. This accounts for a <strong>1-3%</strong> increase in overall energy harvested.</p>
                </div>
                <div class="bg-gray-50 p-4 rounded-lg">
                    <h3 class="font-bold text-lg mb-2">South-Facing vs. Split Orientation</h3>
                    <p class="text-sm text-gray-600">The "Hourly Production Curve" chart clearly shows the trade-off. The <strong>South-Facing (190°)</strong> setup has a much higher peak output, ideal for quickly charging batteries or running high-power devices around noon. The <strong>Split Orientation</strong> produces a wider, flatter curve, generating usable power for more hours of the day. This is better for covering a household's continuous base load, even though its total daily yield is slightly lower.</p>
                </div>
                <div class="bg-gray-50 p-4 rounded-lg">
                    <h3 class="font-bold text-lg mb-2">Charging Performance</h3>
                    <p class="text-sm text-gray-600">With the 220W south-facing setup, the "Summer Day Charging Simulation" shows the battery can be fully charged from 20% by around 2 PM (14:00) on a clear day. This leaves several hours of afternoon sun where the generated power can be used directly by an inverter or other loads, maximizing the use of your solar energy.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- DATA ---
        const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
        const daysInMonth = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
        
        const dailyYield110W_190deg = [0.16, 0.26, 0.34, 0.35, 0.36, 0.37, 0.38, 0.38, 0.35, 0.28, 0.18, 0.14];
        const dailyYield220W_190deg = dailyYield110W_190deg.map(d => d * 2);
        const dailyYield110W_100deg = [0.14, 0.23, 0.32, 0.35, 0.36, 0.37, 0.38, 0.36, 0.32, 0.25, 0.15, 0.12];
        const dailyYield220W_Split = dailyYield110W_190deg.map((d, i) => d + dailyYield110W_100deg[i]);

        const chartData = {
            monthly: { labels: months, datasets: [ { label: '110W @ 190°', data: dailyYield110W_190deg.map((d, i) => (d * daysInMonth[i]).toFixed(1)), backgroundColor: 'rgba(147, 197, 253, 0.8)' }, { label: '220W @ 190°', data: dailyYield220W_190deg.map((d, i) => (d * daysInMonth[i]).toFixed(1)), backgroundColor: 'rgba(59, 130, 246, 0.8)' }, { label: '220W Split (SE+SW)', data: dailyYield220W_Split.map((d, i) => (d * daysInMonth[i]).toFixed(1)), backgroundColor: 'rgba(30, 64, 175, 0.8)' } ] },
            daily: { labels: months, datasets: [ { label: '110W @ 190°', data: dailyYield110W_190deg, backgroundColor: 'rgba(147, 197, 253, 0.8)' }, { label: '220W @ 190°', data: dailyYield220W_190deg, backgroundColor: 'rgba(59, 130, 246, 0.8)' }, { label: '220W Split (SE+SW)', data: dailyYield220W_Split, backgroundColor: 'rgba(30, 64, 175, 0.8)' } ] }
        };
        
        // --- HOURLY PRODUCTION DATA (Watts) ---
        const hourlyProd_110W_South = [0,0,0,0,0, 8, 25, 50, 75, 90, 100, 105, 108, 105, 95, 70, 45, 20, 5, 0,0,0,0,0];
        const hourlyProd_110W_SE =    [0,0,0,0,0, 20, 55, 85, 105, 100, 85, 70, 55, 40, 25, 10, 5, 0, 0, 0,0,0,0,0];
        const hourlyProd_220W_South = hourlyProd_110W_South.map(p => p * 2);
        const hourlyProd_220W_Split = hourlyProd_110W_South.map((p, i) => p + hourlyProd_110W_SE[i]);
        const productionTimeLabels = Array.from({length: 24}, (_, i) => new Date(2025, 5, 14, i, 0));


        // --- MAIN YIELD CHART ---
        const ctxYield = document.getElementById('solarYieldChart').getContext('2d');
        const solarYieldChart = new Chart(ctxYield, { type: 'bar', data: chartData.monthly, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'top' }, title: { display: true, text: 'Estimated Monthly Energy Yield (kWh)', font: { size: 16 } }, tooltip: { callbacks: { label: (c) => `${c.dataset.label}: ${c.parsed.y} kWh` } } }, scales: { y: { beginAtZero: true, title: { display: true, text: 'Energy (kWh)' } } } } });
        const viewMonthlyBtn = document.getElementById('viewMonthly');
        const viewDailyBtn = document.getElementById('viewDaily');
        function updateYieldChart(view) { solarYieldChart.data = view === 'monthly' ? chartData.monthly : chartData.daily; solarYieldChart.options.plugins.title.text = view === 'monthly' ? 'Estimated Monthly Energy Yield (kWh)' : 'Estimated Average Daily Yield (kWh)'; viewMonthlyBtn.classList.toggle('bg-blue-600', view === 'monthly'); viewMonthlyBtn.classList.toggle('text-white', view === 'monthly'); viewDailyBtn.classList.toggle('bg-blue-600', view === 'daily'); viewDailyBtn.classList.toggle('text-white', view === 'daily'); viewMonthlyBtn.classList.toggle('bg-white', view !== 'monthly'); viewDailyBtn.classList.toggle('bg-white', view !== 'daily'); solarYieldChart.update(); }
        viewMonthlyBtn.addEventListener('click', () => updateYieldChart('monthly'));
        viewDailyBtn.addEventListener('click', () => updateYieldChart('daily'));

        // --- HOURLY PRODUCTION CHART ---
        const ctxProduction = document.getElementById('productionCurveChart').getContext('2d');
        const productionCurveChart = new Chart(ctxProduction, {
            type: 'line',
            data: {
                labels: productionTimeLabels,
                datasets: [
                    { label: '110W South (190°)', data: hourlyProd_110W_South, borderColor: 'rgba(147, 197, 253, 1)', backgroundColor: 'rgba(147, 197, 253, 0.2)', fill: true, tension: 0.4, pointRadius: 0 },
                    { label: '220W South (190°)', data: hourlyProd_220W_South, borderColor: 'rgba(59, 130, 246, 1)', backgroundColor: 'rgba(59, 130, 246, 0.2)', fill: true, tension: 0.4, pointRadius: 0 },
                    { label: '220W Split (SE+SW)', data: hourlyProd_220W_Split, borderColor: 'rgba(30, 64, 175, 1)', backgroundColor: 'rgba(30, 64, 175, 0.2)', fill: true, tension: 0.4, pointRadius: 0 }
                ]
            },
            options: { responsive: true, maintainAspectRatio: false, scales: { x: { type: 'time', time: { unit: 'hour', displayFormats: { hour: 'HH:mm' } }, title: { display: true, text: 'Time of Day' } }, y: { beginAtZero: true, title: { display: true, text: 'Power (Watts)' } } }, plugins: { legend: { position: 'top' }, tooltip: { mode: 'index', intersect: false } } }
        });

        // --- CHARGING CURVE CHART ---
        const batteryCapacityWh = 640;
        const initialSoC = 0.20;
        let batteryEnergyWh = batteryCapacityWh * initialSoC;
        const hourlyGenWh_220W_South = hourlyProd_220W_South; // In this simplified model, hourly production in Watts is roughly equal to Watt-hours for that hour.
        const chargingData = [];
        for (let hour = 0; hour < 24; hour++) { batteryEnergyWh += hourlyGenWh_220W_South[hour]; if (batteryEnergyWh > batteryCapacityWh) { batteryEnergyWh = batteryCapacityWh; } const currentSoC = (batteryEnergyWh / batteryCapacityWh) * 100; chargingData.push({ x: new Date(2025, 5, 14, hour, 0), y: currentSoC.toFixed(1) }); }
        const ctxCharging = document.getElementById('chargingCurveChart').getContext('2d');
        const chargingCurveChart = new Chart(ctxCharging, { type: 'line', data: { datasets: [{ label: 'Battery State of Charge (%)', data: chargingData, borderColor: 'rgb(59, 130, 246)', backgroundColor: 'rgba(59, 130, 246, 0.1)', fill: true, tension: 0.4 }] }, options: { responsive: true, maintainAspectRatio: false, scales: { x: { type: 'time', time: { unit: 'hour', displayFormats: { hour: 'HH:mm' } }, title: { display: true, text: 'Time of Day' } }, y: { beginAtZero: true, max: 100, title: { display: true, text: 'State of Charge (%)' } } }, plugins: { legend: { display: false } } } });
    </script>
</body>
</html>
